"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),WebBook=function(){function t(e,i){var n=this;_classCallCheck(this,t),this._bookContainer=e,this._textContainer=e.querySelector("[data-wb-text-container]"),this._text=e.querySelector("[data-wb-text]"),this._height=i.height,this._width=i.maxWidth,this._marginX=void 0===i.marginX?35:i.marginX,this._marginY=void 0===i.marginY?20:i.marginY,this._position=0,this.col=!0,this._bookmark=null,this._containerWidth=null,this._lastBreak=document.createElement("div"),this._lastBreak.className="wb-text-break",this._text.appendChild(this._lastBreak),this._lastElement=document.createElement("div"),this._lastElement.innerHTML="&nbsp;",this._lastElement.className="wb-section wb-no-toc",this._text.appendChild(this._lastElement),this._sections=this._text.querySelectorAll(".wb-section"),this._breaks=this._text.querySelectorAll(".wb-text-break"),this._elements=this._text.querySelectorAll(":not(.wb-text-break)"),this._tocs=this._bookContainer.querySelectorAll("[data-wb-toc]"),this.getToc(),this._currentPages=this._bookContainer.querySelectorAll(".wb-current-page"),this._totalPages=this._bookContainer.querySelectorAll(".wb-total-pages"),this._currentTotalPages=this._bookContainer.querySelectorAll(".wb-currentByTotal-pages"),this._elPageNumbers=this._bookContainer.querySelectorAll("[data-wb-element-page-number]"),this._sectionTitles=this._bookContainer.querySelectorAll(".wb-current-section-title"),this._startPage=null,this._bookContainer.querySelectorAll(".wb-link").forEach(function(t){t.addEventListener("click",function(t){if(!0===n.col){t.preventDefault();var e=t.currentTarget.getAttribute("href").replace(/^#/,"");n.goToPage(n.elementPageNumber(e))}},!1)}),("WebkitColumnWidth"in document.body.style||"MozColumnWidth"in document.body.style||"columnWidth"in document.body.style)&&this.toBook()}return _createClass(t,[{key:"toBook",value:function(){if("WebkitColumnWidth"in document.body.style||"MozColumnWidth"in document.body.style||"columnWidth"in document.body.style){this.col=!0;var t=this._textContainer.style,e=this._text.style;t.boxSizing="border-box",t.overflow="hidden",t.position="relative",t.padding="0px",t.height=this.getHeight()+"px",t.maxWidth=this.getMaxWidth()+"px",this._containerWidth=this._textContainer.clientWidth;for(var i=0;i<this._sections.length;i++)"10%"!==this._sections[i].style.minHeight&&(this._sections[i].style.minHeight="10%");for(var n=0;n<this._breaks.length;n++)"300%"!==this._breaks[n].style.marginBottom&&(this._breaks[n].style.marginBottom="300%");"300%"!==this._lastElement.style.marginBottom&&(this._lastElement.style.marginBottom="300%"),e.boxSizing="border-box",e.position="absolute",e.left=0,e.top=0,e.height="100%",e.width="100%",e.paddingRight=this.getMarginX()+"px",e.paddingLeft=this.getMarginX()+"px",e.paddingTop=this.getMarginY()+"px",e.paddingBottom=this.getMarginY()+"px",e.MozColumnFill="auto",e.WebkitColumnsWidth=this._containerWidth+"px",e.MozColumnWidth=this._containerWidth+"px",e.columnWidth=this._containerWidth+"px",e.MozColumnGap=2*this.getMarginX()+"px",e.WebkitColumnGap=2*this.getMarginX()+"px",e.columnGap=2*this.getMarginX()+"px",this._bookmark&&(this.goToBookmark(this._bookmark),this._position=this._text.offsetLeft),this.refresh()}}},{key:"toScroll",value:function(){this.col=!1;var t=this._container.style,e=this._text.style;t.height="auto",t.maxWidth=this.getMaxWidth()+"px",t.overflow="visible",e.position="static",e.height="auto",t.paddingRight=this.getMarginX()+"px",t.paddingLeft=this.getMarginX()+"px",t.paddingTop=this.getMarginY()+"px",t.paddingBottom=this.getMarginY()+"px",("WebkitColumnWidth"in document.body.style||"MozColumnWidth"in document.body.style||"columnWidth"in document.body.style)&&(e.WebkitColumns="auto 1",e.MozColumns="auto 1",e.columns="auto 1");for(var i=0;i<this._sections.length;i++)this._sections[i].style.minHeight="0";for(var n=0;n<this._breaks.length;n++)this._breaks[n].style.marginBottom="0";this._lastElement.style.marginBottom="0px",this.refresh()}},{key:"setMaxWidth",value:function(t){return this._width=t,this}},{key:"getMaxWidth",value:function(){return this._width}},{key:"setHeight",value:function(t){return this._height=t,this}},{key:"getHeight",value:function(){return this._height}},{key:"setMarginX",value:function(t){return this._marginX=t,this}},{key:"getMarginX",value:function(){return this._marginX}},{key:"setMarginY",value:function(t){return this._marginY=t,this}},{key:"getMarginY",value:function(){return this._marginY}},{key:"forward",value:function(){this._lastElement.offsetLeft+this._position>this._containerWidth+this.getMarginX()&&(this._position=this._text.offsetLeft,this._position-=this._containerWidth,this._text.style.left=this._position+"px",this.refresh())}},{key:"backward",value:function(){this._position<0&&(this._position=this._text.offsetLeft,this._position+=this._containerWidth,this._text.style.left=this._position+"px",this.refresh())}},{key:"toFirstPage",value:function(){this._position<0&&(this._position=0,this._text.style.left=this._position+"px",this.refresh())}},{key:"toLastPage",value:function(){this._lastElement.offsetLeft+this._position>this._containerWidth+this.getMarginX()&&(this._position=this._containerWidth+this.getMarginX()-this._lastElement.offsetLeft,this._text.style.left=this._position+"px",this.refresh())}},{key:"getPageStart",value:function(){for(var t=void 0,e=void 0,i=0;i<this._sections.length-1;i++)if(this._sections[i].className.match(/wb-no-page/))t=i;else if(void 0!==t&&void 0===e){e=i;var n=this._sections[e].offsetLeft-this.getMarginX();n=n%this._containerWidth!=0?n-n%this._containerWidth:n,this._startPage=n/this._containerWidth}}},{key:"checkFirstPage",value:function(){return 0===this._position}},{key:"getPageNumber",value:function(){var t=Math.abs(Math.floor(this._position/this._containerWidth))+1;return t-=this._startPage}},{key:"getTotalPages",value:function(){var t=Math.floor(this._lastElement.offsetLeft/this._containerWidth);return t-=this._startPage}},{key:"goToPage",value:function(t){t=(t=t<1-this._startPage?1-this._startPage:t)>this.getTotalPages()?this.getTotalPages():t,t+=this._startPage;var e=this._containerWidth*(t-1);this._text.style.left=-e+"px",this._position=this._text.offsetLeft,this.refresh()}},{key:"elementPageNumber",value:function(t){var e=this._text.querySelector("#"+t).offsetLeft-this.getMarginX(),i=(e=e%this._containerWidth!=0?e-e%this._containerWidth:e)/this._containerWidth+1;return i-=this._startPage}},{key:"getSectionTitle",value:function(){for(var t=-this._position,e=void 0,i=1;i<this._sections.length;i++)if(this._sections[i].offsetLeft-this._containerWidth>=t){var n=this._sections[i-1].id;e=void 0!==n&&this.getPageNumber()===this.elementPageNumber(n)?"":this._sections[i-1].title;break}return e}},{key:"getToc",value:function(){var t=this;0!==this._tocs.length&&this._tocs.forEach(function(e){if(e.getAttribute("data-wb-toc")){var i=document.createElement("p");i.setAttribute("class","wb-toc-title"),i.innerHTML=e.getAttribute("data-wb-toc"),e.appendChild(i)}var n=document.createElement("ul");n.setAttribute("class","wb-toc-list"),t._sections.forEach(function(t){if(!t.className.match(/wb-no-toc/)){var e=document.createElement("li");e.setAttribute("class","wb-toc-item");var i=document.createElement("a");i.setAttribute("href","#"+t.id),i.setAttribute("class","wb-link");var s=document.createElement("span");s.setAttribute("class","wb-toc-item-title"),s.innerHTML=t.title;var o=document.createElement("span");s.setAttribute("class","wb-toc-item-page-number"),o.setAttribute("data-wb-element-page-number",t.id),i.appendChild(s),i.appendChild(o),e.appendChild(i),n.appendChild(e)}}),e.appendChild(n)})}},{key:"getTocCurrentSection",value:function(){var t=this,e=-this._position;this._tocs.forEach(function(i){for(var n=1;n<t._sections.length&&!(t._sections[n].offsetLeft-t._containerWidth>=e&&"break"===function(){var e=t._sections[n-1].id;return i.querySelectorAll("a").forEach(function(t){t.getAttribute("href").replace(/^#/,"")===e?t.parentElement.className.match(/current/)||(t.parentElement.className+=" current"):t.parentElement.className.match(/current/)&&(t.parentElement.className=t.parentElement.className.replace(/ current/,""))}),"break"}());n++);})}},{key:"insertBookmark",value:function(){for(var t=null,e=0;e<this._elements.length;e++){var i=this._elements[e].offsetLeft-this.getMarginX();if((i=i%this._containerWidth!=0?i-i%this._containerWidth:i)===-this._position){t=e;break}if(i>-this._position){t=e-1;break}}this._bookmark=t}},{key:"goToBookmark",value:function(t){var e=this._elements[this._bookmark].offsetLeft-this.getMarginX();e=e%this._containerWidth!=0?e-e%this._containerWidth:e,this._text.style.left=-e+"px",this._position=this._text.offsetLeft,this.refresh()}},{key:"refresh",value:function(){var t=this;this.insertBookmark(),!1===this.col?(this._currentPages.forEach(function(t){t.innerHTML=""}),this._totalPages.forEach(function(t){t.innerHTML=""}),this._currentTotalPages.forEach(function(t){t.innerHTML=""}),this._elPageNumbers.forEach(function(t){t.innerHTML=""}),this._sectionTitles.forEach(function(t){t.innerHTML=""})):(this.getPageStart(),0!==this._tocs.length&&this.getTocCurrentSection(),this._currentPages.forEach(function(e){e.innerHTML!=t.getPageNumber()&&(e.innerHTML=t.getPageNumber())}),this._totalPages.forEach(function(e){e.innerHTML!=t.getTotalPages()&&(e.innerHTML=t.getTotalPages())}),this._currentTotalPages.forEach(function(e){t.getPageNumber()<1?e.innerHTML="&emsp;&emsp;":e.innerHTML!==t.getPageNumber()+"/"+t.getTotalPages()&&(e.innerHTML=t.getPageNumber()+"/"+t.getTotalPages())}),this._elPageNumbers.forEach(function(e){var i=e.getAttribute("data-wb-element-page-number"),n=t.elementPageNumber(i);n<1?e.innerHTML="":e.innerHTML!=n&&(e.innerHTML=n)}),this._sectionTitles.forEach(function(e){e.innerHTML!==t.getSectionTitle()&&(e.innerHTML=t.getSectionTitle())}))}}]),t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYi1ib29rLmpzIl0sIm5hbWVzIjpbIldlYkJvb2siLCJib29rQ29udGFpbmVyIiwib3B0aW9ucyIsIl90aGlzIiwidGhpcyIsIl9jbGFzc0NhbGxDaGVjayIsIl9ib29rQ29udGFpbmVyIiwiX3RleHRDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiX3RleHQiLCJfaGVpZ2h0IiwiX3dpZHRoIiwibWF4V2lkdGgiLCJfbWFyZ2luWCIsInVuZGVmaW5lZCIsIm1hcmdpblgiLCJfbWFyZ2luWSIsIm1hcmdpblkiLCJfcG9zaXRpb24iLCJoZWlnaHQiLCJfbGFzdEVsZW1lbnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJjb2wiLCJjbGFzc05hbWUiLCJfYm9va21hcmsiLCJfc2VjdGlvbnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2xhc3RCcmVhayIsIl9lbGVtZW50cyIsIl90b3RhbFBhZ2VzIiwiX2JyZWFrcyIsIl9lbFBhZ2VOdW1iZXJzIiwiX3RvY3MiLCJmb3JFYWNoIiwidmFsIiwiX2N1cnJlbnRQYWdlcyIsImUiLCJfY3VycmVudFRvdGFsUGFnZXMiLCJfc2VjdGlvblRpdGxlcyIsImdvVG9QYWdlIiwiZWxlbWVudFBhZ2VOdW1iZXIiLCJpZCIsImJvZHkiLCJzdHlsZSIsInByZXZlbnREZWZhdWx0IiwiY3MiLCJ0cyIsInRvQm9vayIsImJveFNpemluZyIsIm92ZXJmbG93IiwicG9zaXRpb24iLCJwYWRkaW5nIiwiZ2V0SGVpZ2h0IiwiZ2V0TWF4V2lkdGgiLCJfY29udGFpbmVyV2lkdGgiLCJjbGllbnRXaWR0aCIsImkiLCJsZW5ndGgiLCJtaW5IZWlnaHQiLCJtYXJnaW5Cb3R0b20iLCJsZWZ0IiwidG9wIiwid2lkdGgiLCJwYWRkaW5nUmlnaHQiLCJwYWRkaW5nTGVmdCIsImdldE1hcmdpblgiLCJwYWRkaW5nVG9wIiwiZ2V0TWFyZ2luWSIsInBhZGRpbmdCb3R0b20iLCJNb3pDb2x1bW5GaWxsIiwiV2Via2l0Q29sdW1uc1dpZHRoIiwib2Zmc2V0TGVmdCIsIldlYmtpdENvbHVtbkdhcCIsIl9jb250YWluZXIiLCJjb2x1bW5zIiwicmVmcmVzaCIsInciLCJoIiwibSIsImluZGV4IiwibWF0Y2giLCJzdGFydEluZGV4IiwiZWxQb3NpdGlvbiIsInBhZ2VOdW1iZXIiLCJNYXRoIiwiYWJzIiwiZmxvb3IiLCJfc3RhcnRQYWdlIiwidG90YWxQYWdlcyIsIm51bWJlciIsImdldFRvdGFsUGFnZXMiLCJlbFBhZ2VOdW1iZXIiLCJ0aXRsZSIsImdldFBhZ2VOdW1iZXIiLCJnZXRBdHRyaWJ1dGUiLCJ0b2NUaXRsZSIsInNldEF0dHJpYnV0ZSIsImVsIiwiX3RoaXMyIiwiaXRlbSIsImxpbmsiLCJwYWdlIiwiYXBwZW5kQ2hpbGQiLCJsaXN0IiwiX3RoaXMzIiwidG9jIiwicGFyZW50RWxlbWVudCIsInJlcGxhY2UiLCJib29rbWFyayIsImluc2VydEJvb2ttYXJrIiwiZ2V0VG9jQ3VycmVudFNlY3Rpb24iLCJlbGVtZW50IiwiX3RoaXM0IiwiZ2V0U2VjdGlvblRpdGxlIl0sIm1hcHBpbmdzIjoiNlhBQU1BLG1CQUNMLFNBQUFBLEVBQVlDLEVBQWVDLEdBQVMsSUFBQUMsRUFBQUMsS0FBQUMsZ0JBQUFELEtBQUFKLEdBRW5DSSxLQUFLRSxlQUFpQkwsRUFDdEJHLEtBQUtHLGVBQWlCTixFQUFjTyxjQUFjLDRCQUNsREosS0FBS0ssTUFBUVIsRUFBY08sY0FBYyxrQkFKMUNKLEtBQUFNLFFBQUFSLEVBQVlELE9BQXdCRyxLQUFBTyxPQUFBVCxFQUFBVSxTQVFuQ1IsS0FBS1MsY0FBNkJDLElBQWxCWixFQUFRYSxRQUFzQixHQUFLYixFQUFRYSxRQVJ4QlgsS0FBQVksY0FBQUYsSUFBQVosRUFBQWUsUUFBQSxHQUFBZixFQUFBZSxRQUNuQ2IsS0FBQWMsVUFBQSxFQUNBZCxLQUFLRSxLQUFBQSxFQUNMRixLQUFLRyxVQUFBQSxLQUNMSCxLQUFLSyxnQkFBUVIsS0FFYkcsS0FBS00sV0FBVVIsU0FBUWlCLGNBQXZCLE9B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Q3ZCckIsRUFBQUEsVUFBWUEsRUFBUzJDLG1CQUlyQjNGLEtBQUt5RSxZQUFMMUMsUUFBQSxTQUFBQyxHQUNBQSxFQUFBYixXQUFBMkYsRUFBQXRCLGtCQTJDR3hELEVBQUliLFVBQVkyRixFQUFLdEIsbUJBSXZCeEYsS0FBS21DLG1CQUFtQkosUUFBUyxTQUFBQyxHQTVDbEM4RSxFQUFLSCxnQkFBTCxFQThDRzNFLEVBQUliLFVBQVksZUE1Q1hDLEVBQUxELFlBQWtCMkYsRUFBQW5CLGdCQUFBLElBQUFtQixFQUFBdEIsa0JBOENsQnhELEVBQUliLFVBQVkyRixFQUFLbkIsZ0JBQWtCLElBQU1tQixFQUFLdEIsbUJBSXBEeEYsS0FBSzZCLGVBQWVFLFFBQVMsU0FBQUMsR0E1QzdCLElBQUFPLEVBQUtaLEVBQUFBLGFBQXFCLCtCQUN6QkssRUFBZ0I4RSxFQUFoQnhFLGtCQUFBQyxHQUREMEMsRUFBQSxFQWdERWpELEVBQUliLFVBQVksR0E1Q2JnQixFQUFBQSxXQUFtQkosSUFDdkJDLEVBQUliLFVBQVk4RCxLQUloQmpELEtBQUFBLGVBQUFELFFBQUEsU0FBQUMsR0FEREEsRUFBQWIsWUFBQTJGLEVBQUFDLG9CQWdERS9FLEVBQUliLFVBQVkyRixFQUFLQyIsImZpbGUiOiJ3ZWItYm9vay5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBXZWJCb29rIHtcblx0Y29uc3RydWN0b3IoYm9va0NvbnRhaW5lciwgb3B0aW9ucykge1xuXHRcdC8vY29udGFpbmVyc1xuXHRcdHRoaXMuX2Jvb2tDb250YWluZXIgPSBib29rQ29udGFpbmVyO1xuXHRcdHRoaXMuX3RleHRDb250YWluZXIgPSBib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXdiLXRleHQtY29udGFpbmVyXScpO1xuXHRcdHRoaXMuX3RleHQgPSBib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXdiLXRleHRdJyk7XG5cdFx0Ly9vcHRpb25zXG5cdFx0dGhpcy5faGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG5cdFx0dGhpcy5fd2lkdGggPSBvcHRpb25zLm1heFdpZHRoO1xuXHRcdHRoaXMuX21hcmdpblggPSBvcHRpb25zLm1hcmdpblg9PT11bmRlZmluZWQgPyAzNSA6IG9wdGlvbnMubWFyZ2luWDtcblx0XHR0aGlzLl9tYXJnaW5ZID0gb3B0aW9ucy5tYXJnaW5ZPT09dW5kZWZpbmVkID8gMjAgOiBvcHRpb25zLm1hcmdpblk7XG5cdFx0Ly9pbml0IHBvc2l0aW9uLCBjb2wgLGNvbnRhaW5lcldpZHRoIGFuZCBib29rbWFya1xuXHRcdHRoaXMuX3Bvc2l0aW9uID0gMDtcblx0XHR0aGlzLmNvbCA9IHRydWU7Ly9kZWZhdWx0IHRydWUgPSB0b0Jvb2soKVxuXHRcdHRoaXMuX2Jvb2ttYXJrID0gbnVsbDtcblx0XHR0aGlzLl9jb250YWluZXJXaWR0aCA9IG51bGw7XG5cdFx0Ly90aGlzLmxhc3RCcmVhayBpcyB1c2VkIGFzIGEgZ2hvc3QgcGFnZVxuXHRcdHRoaXMuX2xhc3RCcmVhayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5fbGFzdEJyZWFrLmNsYXNzTmFtZSA9IFwid2ItdGV4dC1icmVha1wiO1xuXHRcdHRoaXMuX3RleHQuYXBwZW5kQ2hpbGQodGhpcy5fbGFzdEJyZWFrKTtcblx0XHQvL3RoaXMuX2xhc3RFbGVtZW50IGlzIHVzZWQgYXMgbGFuZG1hcmtcblx0XHR0aGlzLl9sYXN0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5fbGFzdEVsZW1lbnQuaW5uZXJIVE1MID0gXCImbmJzcDtcIjsvL25vdCBlbXB0eSAoZm9yIG1vekNvbHVtbnMpXG5cdFx0dGhpcy5fbGFzdEVsZW1lbnQuY2xhc3NOYW1lID0gXCJ3Yi1zZWN0aW9uIHdiLW5vLXRvY1wiO1xuXHRcdHRoaXMuX3RleHQuYXBwZW5kQ2hpbGQodGhpcy5fbGFzdEVsZW1lbnQpO1xuXHRcdC8vc2VjdGlvbnNcblx0XHR0aGlzLl9zZWN0aW9ucyA9IHRoaXMuX3RleHQucXVlcnlTZWxlY3RvckFsbCgnLndiLXNlY3Rpb24nKTtcblx0XHQvL2JyZWFrc1xuXHRcdHRoaXMuX2JyZWFrcyA9IHRoaXMuX3RleHQucXVlcnlTZWxlY3RvckFsbCgnLndiLXRleHQtYnJlYWsnKTtcblx0XHQvL2VsZW1lbnRzIDogc2VsZWN0IGFsbCBlbGVtZW50cyBidXQgLnRleHQtYnJlYWtzIChmb3IgYm9va21hcmtzKVxuXHRcdHRoaXMuX2VsZW1lbnRzID0gdGhpcy5fdGV4dC5xdWVyeVNlbGVjdG9yQWxsKCc6bm90KC53Yi10ZXh0LWJyZWFrKScpO1xuXHRcdC8vdG9jXG5cdFx0dGhpcy5fdG9jcyA9IHRoaXMuX2Jvb2tDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtd2ItdG9jXScpO1xuXHRcdC8vc2V0VG9jIGJlZm9yZSBxdWVyeWluZyB0aGlzLmVsUGFnZU51bWJlcnNcblx0XHR0aGlzLmdldFRvYygpO1xuXHRcdC8vaW5mb3MgY29udGFpbmVyc1xuXHRcdHRoaXMuX2N1cnJlbnRQYWdlcyA9IHRoaXMuX2Jvb2tDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLndiLWN1cnJlbnQtcGFnZScpO1xuXHRcdHRoaXMuX3RvdGFsUGFnZXMgPSB0aGlzLl9ib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy53Yi10b3RhbC1wYWdlcycpO1xuXHRcdHRoaXMuX2N1cnJlbnRUb3RhbFBhZ2VzID0gdGhpcy5fYm9va0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcud2ItY3VycmVudEJ5VG90YWwtcGFnZXMnKTtcblx0XHR0aGlzLl9lbFBhZ2VOdW1iZXJzID0gdGhpcy5fYm9va0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS13Yi1lbGVtZW50LXBhZ2UtbnVtYmVyXScpO1xuXHRcdHRoaXMuX3NlY3Rpb25UaXRsZXMgPSB0aGlzLl9ib29rQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy53Yi1jdXJyZW50LXNlY3Rpb24tdGl0bGUnKTtcblx0XHQvL3N0YXJ0IHBhZ2luYXRpb25cblx0XHR0aGlzLl9zdGFydFBhZ2UgPSBudWxsO1xuXHRcdC8vbGlua3MgOiByZXBsYWNlIGRlZmF1bHQgd2l0aCBnb1RvUGFnZVxuXHRcdGxldCBsaW5rcyA9IHRoaXMuX2Jvb2tDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLndiLWxpbmsnKTtcblx0XHRsaW5rcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0dmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cdFx0XHRcdGlmKHRoaXMuY29sPT09dHJ1ZSkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRsZXQgaHJlZiA9IGUuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTtcblx0XHRcdFx0XHRsZXQgaWQgPSBocmVmLnJlcGxhY2UoL14jLyxcIlwiKTtcblx0XHRcdFx0XHR0aGlzLmdvVG9QYWdlKHRoaXMuZWxlbWVudFBhZ2VOdW1iZXIoaWQpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSwgZmFsc2UpO1xuXHRcdH0pXG5cdFx0XG5cdFx0XG5cdFx0aWYoJ1dlYmtpdENvbHVtbldpZHRoJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlIHx8ICdNb3pDb2x1bW5XaWR0aCcgaW4gZG9jdW1lbnQuYm9keS5zdHlsZSB8fCAnY29sdW1uV2lkdGgnIGluIGRvY3VtZW50LmJvZHkuc3R5bGUpIHtcblx0XHRcdHRoaXMudG9Cb29rKCk7XG5cdFx0fVxuXG5cdH1cblxuXHR0b0Jvb2soKSB7XG5cdFx0aWYoJ1dlYmtpdENvbHVtbldpZHRoJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlIHx8ICdNb3pDb2x1bW5XaWR0aCcgaW4gZG9jdW1lbnQuYm9keS5zdHlsZSB8fCAnY29sdW1uV2lkdGgnICBpbiBkb2N1bWVudC5ib2R5LnN0eWxlKSB7XG5cdFx0XHR0aGlzLmNvbCA9IHRydWU7XG5cdFx0XHRsZXQgY3MgPSB0aGlzLl90ZXh0Q29udGFpbmVyLnN0eWxlO1xuXHRcdFx0bGV0IHRzID0gdGhpcy5fdGV4dC5zdHlsZTtcblx0XHRcdC8vdGV4dC1jb250YWluZXJcblx0XHRcdGNzLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xuXHRcdFx0Y3Mub3ZlcmZsb3cgPSBcImhpZGRlblwiO1xuXHRcdFx0Y3MucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XG5cdFx0XHRjcy5wYWRkaW5nID0gXCIwcHhcIjtcblx0XHRcdGNzLmhlaWdodCA9IHRoaXMuZ2V0SGVpZ2h0KCkgKyBcInB4XCI7XG5cdFx0XHRjcy5tYXhXaWR0aCA9IHRoaXMuZ2V0TWF4V2lkdGgoKSArIFwicHhcIjsvL21heFdpZHRoIDogcmVzcG9uc2l2ZVxuXHRcdFx0dGhpcy5fY29udGFpbmVyV2lkdGggPSB0aGlzLl90ZXh0Q29udGFpbmVyLmNsaWVudFdpZHRoOy8vcmVzcG9uc2l2ZVxuXHRcdFx0XG5cdFx0XHQvL3NlY3Rpb25zXG5cdFx0XHQvL2hhY2sgZmlyZWZveCAocG91ciBvZmZzZXRMZWZ0KSA6IG1pbkhlaWdodCA9IDEwJVxuXHRcdFx0Zm9yKGxldCBpPTA7IGk8dGhpcy5fc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYodGhpcy5fc2VjdGlvbnNbaV0uc3R5bGUubWluSGVpZ2h0IT09XCIxMCVcIikge1xuXHRcdFx0XHRcdHRoaXMuX3NlY3Rpb25zW2ldLnN0eWxlLm1pbkhlaWdodCA9IFwiMTAlXCI7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdC8vbWFudWFsIGJyZWFrc1xuXHRcdFx0Zm9yKGxldCBpPTA7IGk8dGhpcy5fYnJlYWtzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGlmKHRoaXMuX2JyZWFrc1tpXS5zdHlsZS5tYXJnaW5Cb3R0b20hPT1cIjMwMCVcIikge1xuXHRcdFx0XHRcdHRoaXMuX2JyZWFrc1tpXS5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIjMwMCVcIjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly9sYXN0IGVsZW1lbnRcblx0XHRcdGlmKHRoaXMuX2xhc3RFbGVtZW50LnN0eWxlLm1hcmdpbkJvdHRvbSE9PVwiMzAwJVwiKSB7XG5cdFx0XHRcdHRoaXMuX2xhc3RFbGVtZW50LnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMzAwJVwiO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3RleHRcblx0XHRcdHRzLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xuXHRcdFx0dHMucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG5cdFx0XHR0cy5sZWZ0ID0gMDtcblx0XHRcdHRzLnRvcCA9IDA7XG5cdFx0XHR0cy5oZWlnaHQgPSBcIjEwMCVcIjtcblx0XHRcdHRzLndpZHRoID0gXCIxMDAlXCI7XG5cdFx0XHR0cy5wYWRkaW5nUmlnaHQgPSB0aGlzLmdldE1hcmdpblgoKSArIFwicHhcIjtcblx0XHRcdHRzLnBhZGRpbmdMZWZ0ID0gdGhpcy5nZXRNYXJnaW5YKCkgKyBcInB4XCI7XG5cdFx0XHR0cy5wYWRkaW5nVG9wID0gdGhpcy5nZXRNYXJnaW5ZKCkgKyBcInB4XCI7XG5cdFx0XHR0cy5wYWRkaW5nQm90dG9tID0gdGhpcy5nZXRNYXJnaW5ZKCkgKyBcInB4XCI7XG5cdFx0XHR0cy5Nb3pDb2x1bW5GaWxsID0gXCJhdXRvXCI7Ly9pbXBvcnRhbnQgISEhXG5cdFx0XHR0cy5XZWJraXRDb2x1bW5zV2lkdGggPSB0aGlzLl9jb250YWluZXJXaWR0aCArIFwicHhcIjtcblx0XHRcdHRzLk1vekNvbHVtbldpZHRoID0gdGhpcy5fY29udGFpbmVyV2lkdGggKyBcInB4XCI7XG5cdFx0XHR0cy5jb2x1bW5XaWR0aCA9IHRoaXMuX2NvbnRhaW5lcldpZHRoICsgXCJweFwiO1xuXHRcdFx0dHMuTW96Q29sdW1uR2FwID0gdGhpcy5nZXRNYXJnaW5YKCkqMiArIFwicHhcIjtcblx0XHRcdHRzLldlYmtpdENvbHVtbkdhcCA9IHRoaXMuZ2V0TWFyZ2luWCgpKjIgKyBcInB4XCI7XG5cdFx0XHR0cy5jb2x1bW5HYXAgPSB0aGlzLmdldE1hcmdpblgoKSoyICsgXCJweFwiO1xuXHRcdFx0XG5cdFx0XHQvL0dvIHRvIGJvb2ttYXJrXG5cdFx0XHRpZih0aGlzLl9ib29rbWFyaykge1xuXHRcdFx0XHR0aGlzLmdvVG9Cb29rbWFyayh0aGlzLl9ib29rbWFyayk7XG5cdFx0XHRcdHRoaXMuX3Bvc2l0aW9uID0gdGhpcy5fdGV4dC5vZmZzZXRMZWZ0O1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHQvL1JlZnJlc2ggaW5mbyBjb250YWluZXJzXG5cdFx0XHR0aGlzLnJlZnJlc2goKTtcblx0XHRcdC8vY29uc29sZS5sb2codGhpcy5fYm9va0NvbnRhaW5lci5vZmZzZXRIZWlnaHQgLSB0aGlzLmdldEhlaWdodCgpKTtcblx0XHR9XG5cdH1cblxuXHR0b1Njcm9sbCgpIHtcblx0XHQndXNlIHN0cmljdCc7XG5cdFx0dGhpcy5jb2wgPSBmYWxzZTtcblx0XHRsZXQgY3MgPSB0aGlzLl9jb250YWluZXIuc3R5bGU7XG5cdFx0bGV0IHRzID0gdGhpcy5fdGV4dC5zdHlsZTtcblx0XHQvL2NvbnRhaW5lclxuXHRcdGNzLmhlaWdodCA9IFwiYXV0b1wiO1xuXHRcdGNzLm1heFdpZHRoID0gdGhpcy5nZXRNYXhXaWR0aCgpICsgXCJweFwiO1xuXHRcdGNzLm92ZXJmbG93ID0gXCJ2aXNpYmxlXCI7XG5cdFx0Ly90ZXh0XG5cdFx0dHMucG9zaXRpb24gPSBcInN0YXRpY1wiO1xuXHRcdHRzLmhlaWdodCA9IFwiYXV0b1wiO1xuXHRcdGNzLnBhZGRpbmdSaWdodCA9IHRoaXMuZ2V0TWFyZ2luWCgpICsgXCJweFwiO1xuXHRcdGNzLnBhZGRpbmdMZWZ0ID0gdGhpcy5nZXRNYXJnaW5YKCkgKyBcInB4XCI7XG5cdFx0Y3MucGFkZGluZ1RvcCA9IHRoaXMuZ2V0TWFyZ2luWSgpICsgXCJweFwiO1xuXHRcdGNzLnBhZGRpbmdCb3R0b20gPSB0aGlzLmdldE1hcmdpblkoKSArIFwicHhcIjtcblxuXHRcdGlmKCdXZWJraXRDb2x1bW5XaWR0aCcgaW4gZG9jdW1lbnQuYm9keS5zdHlsZSB8fCAnTW96Q29sdW1uV2lkdGgnIGluIGRvY3VtZW50LmJvZHkuc3R5bGUgfHwgJ2NvbHVtbldpZHRoJyAgaW4gZG9jdW1lbnQuYm9keS5zdHlsZSkge1xuXHRcdFx0dHMuV2Via2l0Q29sdW1ucyA9IFwiYXV0byAxXCI7XG5cdFx0XHR0cy5Nb3pDb2x1bW5zID0gXCJhdXRvIDFcIjtcblx0XHRcdHRzLmNvbHVtbnMgPSBcImF1dG8gMVwiO1xuXHRcdH1cblxuXHRcdC8vU2VjdGlvbnMgKGZvciBtb3pDb2x1bW5zKVxuXHRcdGZvcihsZXQgaT0wOyBpPHRoaXMuX3NlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR0aGlzLl9zZWN0aW9uc1tpXS5zdHlsZS5taW5IZWlnaHQgPSBcIjBcIjtcblx0XHR9XG5cdFx0Ly9tYW51YWwgYnJlYWtzXG5cdFx0Zm9yKGxldCBpPTA7IGk8dGhpcy5fYnJlYWtzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR0aGlzLl9icmVha3NbaV0uc3R5bGUubWFyZ2luQm90dG9tID0gXCIwXCI7XG5cdFx0fVxuXHRcdC8vbGFzdCBlbGVtZW50XG5cdFx0dGhpcy5fbGFzdEVsZW1lbnQuc3R5bGUubWFyZ2luQm90dG9tID0gXCIwcHhcIjtcblxuXHRcdHRoaXMucmVmcmVzaCgpO1xuXHR9O1xuXG5cdHNldE1heFdpZHRoKHcpIHtcblx0XHR0aGlzLl93aWR0aCA9IHc7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRnZXRNYXhXaWR0aCgpIHtcblx0XHRyZXR1cm4gdGhpcy5fd2lkdGg7XG5cdH1cblxuXHRzZXRIZWlnaHQoaCkge1xuXHRcdHRoaXMuX2hlaWdodCA9IGg7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRnZXRIZWlnaHQoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2hlaWdodDtcblx0fVxuXG5cdHNldE1hcmdpblgobSkge1xuXHRcdHRoaXMuX21hcmdpblggPSBtO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0Z2V0TWFyZ2luWCgpIHtcblx0XHRyZXR1cm4gdGhpcy5fbWFyZ2luWDtcblx0fVxuXG5cdHNldE1hcmdpblkobSkge1xuXHRcdHRoaXMuX21hcmdpblkgPSBtO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0Z2V0TWFyZ2luWSgpIHtcblx0XHRyZXR1cm4gdGhpcy5fbWFyZ2luWTtcblx0fVxuXG5cdGZvcndhcmQoKSB7XG5cdFx0aWYodGhpcy5fbGFzdEVsZW1lbnQub2Zmc2V0TGVmdCt0aGlzLl9wb3NpdGlvbiA+IHRoaXMuX2NvbnRhaW5lcldpZHRoK3RoaXMuZ2V0TWFyZ2luWCgpKSB7XG5cdFx0XHQvL2xldCBjbG9uZSA9IHRoaXMuX3RleHQuY2xvbmVOb2RlKHRydWUpO1xuXHRcdFx0dGhpcy5fcG9zaXRpb24gPSB0aGlzLl90ZXh0Lm9mZnNldExlZnQ7XG5cdFx0XHR0aGlzLl9wb3NpdGlvbiAtPSB0aGlzLl9jb250YWluZXJXaWR0aDtcblx0XHRcdHRoaXMuX3RleHQuc3R5bGUubGVmdCA9IHRoaXMuX3Bvc2l0aW9uICsgXCJweFwiO1xuXHRcdFx0XG5cdFx0XHQvL2NvbnNvbGUubG9nKGNsb25lKTtcblx0XHRcdC8vY2xvbmUuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG5cdFx0XHQvL3RoaXMuX2NvbnRhaW5lci5pbnNlcnRCZWZvcmUoY2xvbmUsdGhpcy50ZXh0KTtcblx0XHRcdHRoaXMucmVmcmVzaCgpO1xuXHRcdH1cblx0fVxuXG5cdGJhY2t3YXJkKCkge1xuXHRcdGlmKHRoaXMuX3Bvc2l0aW9uIDwgMCkge1xuXHRcdFx0dGhpcy5fcG9zaXRpb24gPSB0aGlzLl90ZXh0Lm9mZnNldExlZnQ7XG5cdFx0XHR0aGlzLl9wb3NpdGlvbiArPSB0aGlzLl9jb250YWluZXJXaWR0aDtcblx0XHRcdHRoaXMuX3RleHQuc3R5bGUubGVmdCA9IHRoaXMuX3Bvc2l0aW9uICsgXCJweFwiO1xuXHRcdFx0dGhpcy5yZWZyZXNoKCk7XG5cdFx0fVxuXHR9XG5cblx0dG9GaXJzdFBhZ2UoKSB7XG5cdFx0aWYodGhpcy5fcG9zaXRpb24gPCAwKSB7XG5cdFx0XHR0aGlzLl9wb3NpdGlvbiA9IDA7XG5cdFx0XHR0aGlzLl90ZXh0LnN0eWxlLmxlZnQgPSB0aGlzLl9wb3NpdGlvbiArIFwicHhcIjtcblx0XHRcdHRoaXMucmVmcmVzaCgpO1xuXHRcdH1cblx0fVxuXG5cdHRvTGFzdFBhZ2UoKSB7XG5cdFx0aWYodGhpcy5fbGFzdEVsZW1lbnQub2Zmc2V0TGVmdCt0aGlzLl9wb3NpdGlvbiA+IHRoaXMuX2NvbnRhaW5lcldpZHRoK3RoaXMuZ2V0TWFyZ2luWCgpKSB7XG5cdFx0XHR0aGlzLl9wb3NpdGlvbiA9IHRoaXMuX2NvbnRhaW5lcldpZHRoK3RoaXMuZ2V0TWFyZ2luWCgpLXRoaXMuX2xhc3RFbGVtZW50Lm9mZnNldExlZnQ7XG5cdFx0XHR0aGlzLl90ZXh0LnN0eWxlLmxlZnQgPSB0aGlzLl9wb3NpdGlvbitcInB4XCI7XG5cdFx0XHR0aGlzLnJlZnJlc2goKTtcblx0XHR9XG5cdH1cblx0XG5cdGdldFBhZ2VTdGFydCgpIHtcblx0XHRsZXQgaW5kZXgsIHN0YXJ0SW5kZXg7XG5cdFx0Zm9yKGxldCBpPTA7IGk8IHRoaXMuX3NlY3Rpb25zLmxlbmd0aC0xOyBpKyspIHtcblx0XHRcdGlmKHRoaXMuX3NlY3Rpb25zW2ldLmNsYXNzTmFtZS5tYXRjaCgvd2Itbm8tcGFnZS8pKSB7XG5cdFx0XHRcdGluZGV4ID0gaTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKGluZGV4IT09dW5kZWZpbmVkICYmIHN0YXJ0SW5kZXg9PT11bmRlZmluZWQpIHtcblx0XHRcdFx0XHRzdGFydEluZGV4ID0gaTtcblx0XHRcdFx0XHRsZXQgZWwgPSB0aGlzLl9zZWN0aW9uc1tzdGFydEluZGV4XTtcblx0XHRcdFx0XHRsZXQgZWxQb3NpdGlvbiA9IGVsLm9mZnNldExlZnQgLSB0aGlzLmdldE1hcmdpblgoKTtcblx0XHRcdFx0XHRlbFBvc2l0aW9uID0gKGVsUG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGghPT0wID8gZWxQb3NpdGlvbi1lbFBvc2l0aW9uJXRoaXMuX2NvbnRhaW5lcldpZHRoIDogZWxQb3NpdGlvbik7Ly9hbHdheXMgYXQgYSBwYWdlIGJlZ2lubmluZ1xuXHRcdFx0XHRcdHRoaXMuX3N0YXJ0UGFnZSA9IGVsUG9zaXRpb24vdGhpcy5fY29udGFpbmVyV2lkdGg7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGNoZWNrRmlyc3RQYWdlKCkge1xuXHRcdGxldCBjaGVjayA9IHRoaXMuX3Bvc2l0aW9uPT09MCA/IHRydWUgOiBmYWxzZTtcblx0XHRyZXR1cm4gY2hlY2s7XG5cdH1cblxuXHRnZXRQYWdlTnVtYmVyKCkge1xuXHRcdC8vdGhpcy5fcG9zaXRpb24vdGhpcy5fY29udGFpbmVyV2lkdGggaXMgc3RhcnQgb2YgYSBwYWdlIDogc3RhcnQgMCBpcyBwYWdlIDEsLi4uIChzbyA6ICsxKVxuXHRcdGxldCBwYWdlTnVtYmVyID0gTWF0aC5hYnMoTWF0aC5mbG9vcih0aGlzLl9wb3NpdGlvbi90aGlzLl9jb250YWluZXJXaWR0aCkpKzE7XG5cdFx0Ly90aGlzLl9zdGFydFBhZ2UgKHBhZ2luYXRpb24gc3RhcnQpXG5cdFx0cGFnZU51bWJlciA9IHBhZ2VOdW1iZXItKHRoaXMuX3N0YXJ0UGFnZSk7XG5cdFx0cmV0dXJuIHBhZ2VOdW1iZXI7XG5cdH1cblxuXHRnZXRUb3RhbFBhZ2VzKCkge1xuXHRcdGxldCB0b3RhbFBhZ2VzID0gTWF0aC5mbG9vcih0aGlzLl9sYXN0RWxlbWVudC5vZmZzZXRMZWZ0L3RoaXMuX2NvbnRhaW5lcldpZHRoKTtcblx0XHR0b3RhbFBhZ2VzID0gdG90YWxQYWdlcy0odGhpcy5fc3RhcnRQYWdlKTtcblx0XHRyZXR1cm4gdG90YWxQYWdlcztcblx0fVxuXG5cdGdvVG9QYWdlKG51bWJlcikge1xuXHRcdG51bWJlciA9IChudW1iZXI8MS0odGhpcy5fc3RhcnRQYWdlKSA/IDEtKHRoaXMuX3N0YXJ0UGFnZSkgOiBudW1iZXIpO1xuXHRcdG51bWJlcj0gKG51bWJlcj50aGlzLmdldFRvdGFsUGFnZXMoKSA/IHRoaXMuZ2V0VG90YWxQYWdlcygpIDogbnVtYmVyKTtcblx0XHRudW1iZXIgPSBudW1iZXIgKyAodGhpcy5fc3RhcnRQYWdlKTtcblx0XHRsZXQgcG9zaXRpb24gPSB0aGlzLl9jb250YWluZXJXaWR0aCoobnVtYmVyLTEpO1xuXHRcdHRoaXMuX3RleHQuc3R5bGUubGVmdCA9IC1wb3NpdGlvbiArIFwicHhcIjtcblx0XHR0aGlzLl9wb3NpdGlvbiA9IHRoaXMuX3RleHQub2Zmc2V0TGVmdDtcblx0XHR0aGlzLnJlZnJlc2goKTtcblx0fVxuXG5cdGVsZW1lbnRQYWdlTnVtYmVyKGlkKSB7XG5cdFx0bGV0IGVsID0gdGhpcy5fdGV4dC5xdWVyeVNlbGVjdG9yKCcjJyArIGlkKTtcblx0XHRsZXQgZWxQb3NpdGlvbiA9IGVsLm9mZnNldExlZnQgLSB0aGlzLmdldE1hcmdpblgoKTtcblx0XHRlbFBvc2l0aW9uID0gKGVsUG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGghPT0wID8gZWxQb3NpdGlvbi1lbFBvc2l0aW9uJXRoaXMuX2NvbnRhaW5lcldpZHRoIDogZWxQb3NpdGlvbik7Ly9hbHdheXMgYXQgYSBwYWdlIGJlZ2lubmluZ1xuXHRcdGxldCBlbFBhZ2VOdW1iZXIgPSBlbFBvc2l0aW9uL3RoaXMuX2NvbnRhaW5lcldpZHRoICsgMTsvL2VsUG9zaXRpb24vdGhpcy5fY29udGFpbmVyV2lkdGggaXMgcG9zaXRpb24gb2YgYSBwYWdlIDogcG9zaXRpb24gMCBpcyBwYWdlIDEsLi4uXG5cdFx0ZWxQYWdlTnVtYmVyID0gZWxQYWdlTnVtYmVyLSh0aGlzLl9zdGFydFBhZ2UpO1xuXHRcdHJldHVybiBlbFBhZ2VOdW1iZXI7XG5cdH1cblxuXHRnZXRTZWN0aW9uVGl0bGUoKSB7XG5cdFx0bGV0IHBvc2l0aW9uID0gLXRoaXMuX3Bvc2l0aW9uO1xuXHRcdGxldCB0aXRsZTtcblx0XHRmb3IobGV0IGk9MTsgaTx0aGlzLl9zZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuXHRcdFx0aWYodGhpcy5fc2VjdGlvbnNbaV0ub2Zmc2V0TGVmdC10aGlzLl9jb250YWluZXJXaWR0aD49cG9zaXRpb24pIHtcblx0XHRcdFx0bGV0IGlkID0gdGhpcy5fc2VjdGlvbnNbaS0xXS5pZDtcblx0XHRcdFx0aWYoaWQhPT11bmRlZmluZWQgJiYgdGhpcy5nZXRQYWdlTnVtYmVyKCkgPT09IHRoaXMuZWxlbWVudFBhZ2VOdW1iZXIoaWQpKSB7XG5cdFx0XHRcdFx0dGl0bGUgPSBcIlwiO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRpdGxlID0gdGhpcy5fc2VjdGlvbnNbaS0xXS50aXRsZTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRpdGxlO1xuXHR9XG5cdFxuXHRnZXRUb2MoKSB7XG5cdFx0aWYodGhpcy5fdG9jcy5sZW5ndGg9PT0wKSB7IHJldHVybjsgfVxuXHRcdHRoaXMuX3RvY3MuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdGlmKHZhbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItdG9jJykpIHtcblx0XHRcdFx0bGV0IHRvY1RpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRcdFx0XHR0b2NUaXRsZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywnd2ItdG9jLXRpdGxlJyk7XG5cdFx0XHRcdHRvY1RpdGxlLmlubmVySFRNTCA9IHZhbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItdG9jJyk7XG5cdFx0XHRcdHZhbC5hcHBlbmRDaGlsZCh0b2NUaXRsZSk7XG5cdFx0XHR9XG5cdFx0XHRsZXQgbGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cdFx0XHRsaXN0LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCd3Yi10b2MtbGlzdCcpO1xuXHRcdFx0dGhpcy5fc2VjdGlvbnMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0aWYoIXZhbC5jbGFzc05hbWUubWF0Y2goL3diLW5vLXRvYy8pKSB7XG5cdFx0XHRcdFx0bGV0IGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXHRcdFx0XHRcdGl0ZW0uc2V0QXR0cmlidXRlKCdjbGFzcycsJ3diLXRvYy1pdGVtJyk7XG5cdFx0XHRcdFx0bGV0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG5cdFx0XHRcdFx0bGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCAnIycgKyB2YWwuaWQpO1xuXHRcdFx0XHRcdGxpbmsuc2V0QXR0cmlidXRlKCdjbGFzcycsICd3Yi1saW5rJyk7XG5cdFx0XHRcdFx0bGV0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuXHRcdFx0XHRcdHRpdGxlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCd3Yi10b2MtaXRlbS10aXRsZScpO1xuXHRcdFx0XHRcdHRpdGxlLmlubmVySFRNTCA9IHZhbC50aXRsZTtcblx0XHRcdFx0XHRsZXQgcGFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcblx0XHRcdFx0XHR0aXRsZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywnd2ItdG9jLWl0ZW0tcGFnZS1udW1iZXInKTtcblx0XHRcdFx0XHRwYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS13Yi1lbGVtZW50LXBhZ2UtbnVtYmVyJywgdmFsLmlkKTtcblx0XHRcdFx0XHRsaW5rLmFwcGVuZENoaWxkKHRpdGxlKTtcblx0XHRcdFx0XHRsaW5rLmFwcGVuZENoaWxkKHBhZ2UpO1xuXHRcdFx0XHRcdGl0ZW0uYXBwZW5kQ2hpbGQobGluayk7XG5cdFx0XHRcdFx0bGlzdC5hcHBlbmRDaGlsZChpdGVtKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHR2YWwuYXBwZW5kQ2hpbGQobGlzdCk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdGdldFRvY0N1cnJlbnRTZWN0aW9uKCkge1xuXHRcdGxldCBwb3NpdGlvbiA9IC10aGlzLl9wb3NpdGlvbjtcblx0XHR0aGlzLl90b2NzLmZvckVhY2ggKCB0b2MgPT4ge1xuXHRcdFx0Zm9yKGxldCBpPTE7IGk8dGhpcy5fc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYodGhpcy5fc2VjdGlvbnNbaV0ub2Zmc2V0TGVmdC10aGlzLl9jb250YWluZXJXaWR0aD49cG9zaXRpb24pIHtcblx0XHRcdFx0XHRsZXQgaWQgPSB0aGlzLl9zZWN0aW9uc1tpLTFdLmlkO1xuXHRcdFx0XHRcdHRvYy5xdWVyeVNlbGVjdG9yQWxsKCdhJykuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0XHRcdGlmKHZhbC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKS5yZXBsYWNlKC9eIy8sJycpID09PSBpZCkge1xuXHRcdFx0XHRcdFx0XHRpZighdmFsLnBhcmVudEVsZW1lbnQuY2xhc3NOYW1lLm1hdGNoKC9jdXJyZW50LykpIHtcblx0XHRcdFx0XHRcdFx0XHR2YWwucGFyZW50RWxlbWVudC5jbGFzc05hbWUrPScgY3VycmVudCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGlmKHZhbC5wYXJlbnRFbGVtZW50LmNsYXNzTmFtZS5tYXRjaCgvY3VycmVudC8pKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFsLnBhcmVudEVsZW1lbnQuY2xhc3NOYW1lPXZhbC5wYXJlbnRFbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKC8gY3VycmVudC8sJycpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0fVxuXG5cdGluc2VydEJvb2ttYXJrKCkge1xuXHRcdGxldCBib29rbWFyayA9IG51bGw7XG5cdFx0Zm9yKGxldCBpPTA7IGk8dGhpcy5fZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGxldCBlbFBvc2l0aW9uID0gdGhpcy5fZWxlbWVudHNbaV0ub2Zmc2V0TGVmdC10aGlzLmdldE1hcmdpblgoKTtcblx0XHRcdGVsUG9zaXRpb24gPSAoZWxQb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCE9PTAgPyBlbFBvc2l0aW9uLWVsUG9zaXRpb24ldGhpcy5fY29udGFpbmVyV2lkdGggOiBlbFBvc2l0aW9uKTsvL2Fsd2F5cyBhdCBhIHBhZ2UgYmVnaW5uaW5nXG5cdFx0XHRpZihlbFBvc2l0aW9uID09PSAtdGhpcy5fcG9zaXRpb24pXG5cdFx0XHR7XG5cdFx0XHRcdGJvb2ttYXJrID0gaTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGlmKGVsUG9zaXRpb24gPiAtdGhpcy5fcG9zaXRpb24pXG5cdFx0XHR7XG5cdFx0XHRcdGJvb2ttYXJrID0gaS0xO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdFx0dGhpcy5fYm9va21hcmsgPSBib29rbWFyaztcblx0fVxuXG5cdGdvVG9Cb29rbWFyayhib29rbWFyaykge1xuXHRcdGxldCBlbGVtZW50ID0gdGhpcy5fZWxlbWVudHNbdGhpcy5fYm9va21hcmtdO1xuXHRcdC8vcG9zaXRpb24gOiBvZmZzZXRMZWZ0IG9mIGVsZW1lbnQgcmVsYXRpdmUgdG8gdGV4dFxuXHRcdGxldCBwb3NpdGlvbiA9IGVsZW1lbnQub2Zmc2V0TGVmdC10aGlzLmdldE1hcmdpblgoKTtcblx0XHRwb3NpdGlvbiA9IChwb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCE9PTAgPyBwb3NpdGlvbi1wb3NpdGlvbiV0aGlzLl9jb250YWluZXJXaWR0aCA6IHBvc2l0aW9uKTsvL2Fsd2F5cyBhdCBhIHBhZ2UgYmVnaW5uaW5nXG5cdFx0Ly90ZXh0IHBvc2l0aW9uID0gLXBvc2l0aW9uXG5cdFx0dGhpcy5fdGV4dC5zdHlsZS5sZWZ0ID0gLXBvc2l0aW9uICsgXCJweFwiO1xuXHRcdHRoaXMuX3Bvc2l0aW9uID0gdGhpcy5fdGV4dC5vZmZzZXRMZWZ0O1xuXHRcdHRoaXMucmVmcmVzaCgpO1xuXHR9XG5cblx0cmVmcmVzaCgpIHtcblx0XHR0aGlzLmluc2VydEJvb2ttYXJrKCk7XG5cblx0XHRpZih0aGlzLmNvbD09PWZhbHNlKSB7XG5cdFx0XHRcblx0XHRcdHRoaXMuX2N1cnJlbnRQYWdlcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gXCJcIjtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLl90b3RhbFBhZ2VzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBcIlwiO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuX2N1cnJlbnRUb3RhbFBhZ2VzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBcIlwiO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuX2VsUGFnZU51bWJlcnMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0dmFsLmlubmVySFRNTCA9IFwiXCI7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5fc2VjdGlvblRpdGxlcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gXCJcIjtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0fSBlbHNlIHtcblx0XHRcdFxuXHRcdFx0dGhpcy5nZXRQYWdlU3RhcnQoKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5fdG9jcy5sZW5ndGghPT0wKSB7XG5cdFx0XHRcdHRoaXMuZ2V0VG9jQ3VycmVudFNlY3Rpb24oKTtcblx0XHRcdH1cdFxuXHRcdFx0XG5cdFx0XHR0aGlzLl9jdXJyZW50UGFnZXMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0aWYodmFsLmlubmVySFRNTCE9dGhpcy5nZXRQYWdlTnVtYmVyKCkpIHtcblx0XHRcdFx0XHR2YWwuaW5uZXJIVE1MID0gdGhpcy5nZXRQYWdlTnVtYmVyKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLl90b3RhbFBhZ2VzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdGlmKHZhbC5pbm5lckhUTUwhPXRoaXMuZ2V0VG90YWxQYWdlcygpKSB7XG5cdFx0XHRcdFx0dmFsLmlubmVySFRNTCA9IHRoaXMuZ2V0VG90YWxQYWdlcygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5fY3VycmVudFRvdGFsUGFnZXMuZm9yRWFjaCggdmFsID0+IHtcblx0XHRcdFx0aWYodGhpcy5nZXRQYWdlTnVtYmVyKCkgPCAxKSB7XG5cdFx0XHRcdFx0dmFsLmlubmVySFRNTCA9IFwiJmVtc3A7JmVtc3A7XCI7XG5cdFx0XHRcdH0gZWxzZSBpZih2YWwuaW5uZXJIVE1MIT09IHRoaXMuZ2V0UGFnZU51bWJlcigpICsgXCIvXCIgKyB0aGlzLmdldFRvdGFsUGFnZXMoKSkge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSB0aGlzLmdldFBhZ2VOdW1iZXIoKSArIFwiL1wiICsgdGhpcy5nZXRUb3RhbFBhZ2VzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLl9lbFBhZ2VOdW1iZXJzLmZvckVhY2goIHZhbCA9PiB7XG5cdFx0XHRcdGxldCBpZCA9IHZhbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2ItZWxlbWVudC1wYWdlLW51bWJlcicpO1xuXHRcdFx0XHRsZXQgcGFnZU51bWJlciA9IHRoaXMuZWxlbWVudFBhZ2VOdW1iZXIoaWQpO1xuXHRcdFx0XHRpZihwYWdlTnVtYmVyIDwgMSkge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBcIlwiO1xuXHRcdFx0XHR9IGVsc2UgaWYodmFsLmlubmVySFRNTCE9cGFnZU51bWJlcikge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSBwYWdlTnVtYmVyO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5fc2VjdGlvblRpdGxlcy5mb3JFYWNoKCB2YWwgPT4ge1xuXHRcdFx0XHRpZih2YWwuaW5uZXJIVE1MIT09dGhpcy5nZXRTZWN0aW9uVGl0bGUoKSkge1xuXHRcdFx0XHRcdHZhbC5pbm5lckhUTUwgPSB0aGlzLmdldFNlY3Rpb25UaXRsZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdH1cblx0fVxufVxuXG4iXX0=
